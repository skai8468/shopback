<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
</head>
<body>
    <h1>Welcome, {{ user }}!</h1>
    <div 
        class="navigation">
        <button onclick="window.location.href='https://www.shopback.sg/login?redirect=%2Faccount%2Fsubscription'">ShopBack Plus</button>
        <button onclick="window.location.href='https://www.shopback.sg/vouchers'">Vouchers</button>
        <button onclick="window.location.href='https://www.shopback.sg/travel'">Travel</button>
        <button onclick="window.location.href='https://www.shopback.sg/marketplace'">Marketplace</button>
        <button onclick="window.location.href='https://www.shopback.sg/fashion'">Fashion</button>
        <button onclick="window.location.href='https://www.shopback.sg/electronics'">Electronics</button>
        <a href="/dashboard">Dashboard</a>
        <a href="/profile">Profile</a> | |
        <a href="/stampcard">Rewards</a> |
        <a href="/social">Social</a>
        <a href="/logout">Logout</a>
    </div>
    <h2>Available Deals</h2>
    
    <!-- Loop through all available deals -->
    {% for deal in deals %}
    <div class="deal">
        <h3>{{ deal[1] }}</h3>  
        <p>{{ deal[2] }}</p>    
        <p>Base Discount: {{ deal[3] }}%</p>
        <p>Valid Until: {{ deal[4] }}</p>

        <a href="/payment" target="_blank">
            <button>Payment</button>
        </a>
        
        <!-- Create Group for this Deal -->
        <a href="/GroupBuy" target="_blank">
            <button>Group Buy</button>
        </a>
        
        <!-- Share the Group Link (only if join_link exists) -->
        {% if join_link %}
            <!-- Share Deal on WhatsApp -->
            <a href="https://wa.me/?text=Join%20this%20group%20to%20get%20exclusive%20discounts!%20{{ join_link }}" target="_blank">
                <button>Share on WhatsApp</button>
            </a>

            <!-- Share Deal on Telegram -->
            <a href="https://t.me/share/url?url={{ join_link }}&text=Join%20this%20group%20to%20get%20exclusive%20discounts!" target="_blank">
                <button>Share on Telegram</button>
            </a>
        {% endif %}

        <!-- Share Deal on WhatsApp (original) -->
        <a href="https://wa.me/?text=Check%20out%20this%20amazing%20deal%20{{ deal[1] }}%20Base%20Discount%3A%20{{ deal[3] }}%25%20Get%20it%20now%20at%20{{ url_for('dashboard', _external=True) }}" target="_blank">
            <button>Share on WhatsApp</button>
        </a>

        <!-- Share Deal on Telegram (original) -->
        <a href="https://t.me/share/url?url={{ url_for('dashboard', _external=True) }}&text=Check%20out%20this%20amazing%20deal%20{{ deal[1] }}%20Base%20Discount%3A%20{{ deal[3] }}%25%20Get%20it%20now%20at%20{{ url_for('dashboard', _external=True) }}" target="_blank">
            <button>Share on Telegram</button>
        </a>
    </div>
    <br>
{% endfor %}


    <h3>My Groups</h3>
    <p>Join a group to unlock higher discounts as more people join!</p>
    
    <!-- Loop through userâ€™s groups to display join links -->
    {% for group in user_groups %}
        <div class="group">
            <h4>Group for: {{ group.store_name }}</h4>
            <p>Join the group to unlock more discounts!</p>
            <a href="{{ group.join_link }}" target="_blank">
                <button>Join Group</button>
            </a>
        </div>
        <br>
    {% endfor %}

</body>
</html>
